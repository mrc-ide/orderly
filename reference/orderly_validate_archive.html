<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Validate unpacked packets. — orderly_validate_archive • orderly</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validate unpacked packets. — orderly_validate_archive"><meta name="description" content="Validate unpacked packets. Over time, expect this function to
become more fully featured, validating more."><meta property="og:description" content="Validate unpacked packets. Over time, expect this function to
become more fully featured, validating more."><meta property="og:image" content="https://mrc-ide.github.io/orderly/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validate unpacked packets.</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly/blob/main/R/validate.R" class="external-link"><code>R/validate.R</code></a></small>
      <div class="d-none name"><code>orderly_validate_archive.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Validate unpacked packets. Over time, expect this function to
become more fully featured, validating more.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_validate_archive</span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  action <span class="op">=</span> <span class="st">"inform"</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>The query expression. A <code>NULL</code> expression matches everything.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>Optionally, the name of the packet to scope the query on. This
will be intersected with <code>scope</code> arg and is a shorthand way of running
<code>scope = list(name = "name")</code></p></dd>


<dt id="arg-action">action<a class="anchor" aria-label="anchor" href="#arg-action"></a></dt>
<dd><p>The action to take on finding an invalid packet. See
Details.</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>The path to the root directory, or <code>NULL</code> (the
default) to search for one from the current working
directory. This function does not require that the directory is
configured for orderly, and can be any <code>outpack</code> root (see
<code><a href="orderly_init.html">orderly_init()</a></code> for details).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly, a character vector of repaired (or invalid)
packets.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The actions that we can take on finding an invalid packet are:</p><ul><li><p><code>inform</code> (the default): just print information about the problem</p></li>
<li><p><code>orphan</code>: mark the packet as orphaned within the metadata, but
do not touch the files in your archive (by default the directory
<code>archive/</code>) - this is a safe option and will leave you in a
consistent state without deleting anything.</p></li>
<li><p><code>delete</code>: in addition to marking the packet as an orphan, also
delete the files from your archive.</p></li>
</ul><p>Later, we will add a "repair" option to try and fix broken
packets.</p>
<p>The validation interacts with the option
<code>core.require_complete_tree</code>; if this option is <code>TRUE</code>, then a
packet is only valid if all its (recursive) dependencies are also
valid, so the action will apply to packets that have also had
their upstream dependencies invalidated.  This validation will
happen even if the query implied by <code>...</code> does not include these
packets if a complete tree is required.</p>
<p>The validation will also interact with <code>core.use_file_store</code> once
repair is supported, as this becomes trivial.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Start with an archive containing 4 simple packets</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/Rtmp5CJVz5/orderly_ex_1ea84a1e7db3'</span>
<span class="r-in"><span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="orderly_run.html">orderly_run</a></span><span class="op">(</span><span class="st">"data"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20251009-084348-5f4fc292` at 2025-10-09 08:43:48.376786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20251009-084348-5f4fc292 at 2025-10-09 08:43:48.403236 (0.02644992 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20251009-084348-6c682b86` at 2025-10-09 08:43:48.427897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20251009-084348-6c682b86 at 2025-10-09 08:43:48.454669 (0.02677178 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20251009-084348-7a4a3cd3` at 2025-10-09 08:43:48.49841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20251009-084348-7a4a3cd3 at 2025-10-09 08:43:48.52506 (0.02664948 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting packet '<span style="color: #0000BB;">data</span>' `20251009-084348-8c5717c1` at 2025-10-09 08:43:48.552696</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_description(</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +   display = "A demo data set")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; x &lt;- jitter(1:30)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; y &lt;- 0.4 * x + 5 + rnorm(length(x), sd = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; d &lt;- data.frame(x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; orderly_artefact("data.rds", description = "A synthetic dataset")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &gt; saveRDS(d, "data.rds")</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running <span style="color: #0000BB;">data.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Finished 20251009-084348-8c5717c1 at 2025-10-09 08:43:48.578988 (0.02629161 secs)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Suppose someone corrupts a packet by deleting a file:</span></span></span>
<span class="r-in"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/delete.html" class="external-link">file_delete</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"archive"</span>, <span class="st">"data"</span>, <span class="va">ids</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data.rds"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can check all packets, and report on validity</span></span></span>
<span class="r-in"><span><span class="fu">orderly_validate_archive</span><span class="op">(</span>root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-5f4fc292 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-6c682b86 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> 20251009-084348-7a4a3cd3 (data) is invalid due to its files</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-8c5717c1 (data) is valid</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alternatively, we can take action and orphan the invalid packet:</span></span></span>
<span class="r-in"><span><span class="fu">orderly_validate_archive</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"orphan"</span>, root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-5f4fc292 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-6c682b86 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> 20251009-084348-7a4a3cd3 (data) is invalid due to its files</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-8c5717c1 (data) is valid</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># At which point the validation will not find this packet anymore</span></span></span>
<span class="r-in"><span><span class="fu">orderly_validate_archive</span><span class="op">(</span>root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-5f4fc292 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-6c682b86 (data) is valid</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> 20251009-084348-8c5717c1 (data) is valid</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The orphaned packet will no longer be found in most operations:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="orderly_search.html">orderly_search</a></span><span class="op">(</span>root <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "20251009-084348-5f4fc292" "20251009-084348-6c682b86"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "20251009-084348-8c5717c1"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson, Katy Gaythorpe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

