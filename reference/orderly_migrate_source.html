<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Migrate orderly source code — orderly_migrate_source • orderly</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Migrate orderly source code — orderly_migrate_source"><meta name="description" content="Migrate source code for an orderly project.  Periodically, we may
make changes to how orderly works that require you to update your
source code sooner or later.  This function can be used to
automate (or at least accelerate) that process by trying to
rewrite the R code within your project.  See below for details of
migrations and triggers for them."><meta property="og:description" content="Migrate source code for an orderly project.  Periodically, we may
make changes to how orderly works that require you to update your
source code sooner or later.  This function can be used to
automate (or at least accelerate) that process by trying to
rewrite the R code within your project.  See below for details of
migrations and triggers for them."><meta property="og:image" content="https://mrc-ide.github.io/orderly/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">orderly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/orderly.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to orderly</a></li>
    <li><a class="dropdown-item" href="../articles/dependencies.html">Dependencies between packets</a></li>
    <li><a class="dropdown-item" href="../articles/collaboration.html">Collaborative analysis</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from orderly (1.x)</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Outpack metadata</a></li>
    <li><a class="dropdown-item" href="../articles/query.html">Orderly query DSL</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating plugins</a></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/orderly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Migrate orderly source code</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/orderly/blob/main/R/migration.R" class="external-link"><code>R/migration.R</code></a></small>
      <div class="d-none name"><code>orderly_migrate_source.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Migrate source code for an orderly project.  Periodically, we may
make changes to how orderly works that require you to update your
source code sooner or later.  This function can be used to
automate (or at least accelerate) that process by trying to
rewrite the R code within your project.  See below for details of
migrations and triggers for them.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orderly_migrate_source</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"."</span>, dry_run <span class="op">=</span> <span class="cn">FALSE</span>, from <span class="op">=</span> <span class="cn">NULL</span>, to <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to the repository to migrate</p></dd>


<dt id="arg-dry-run">dry_run<a class="anchor" aria-label="anchor" href="#arg-dry-run"></a></dt>
<dd><p>Logical, indicating if no changes would be made,
but just print information about the changes that would be made.
If <code>TRUE</code>, you can run this function against a repository that
is not under version control.</p></dd>


<dt id="arg-from">from<a class="anchor" aria-label="anchor" href="#arg-from"></a></dt>
<dd><p>Optional minimum version to migrate from.  If <code>NULL</code>,
we migrate from the version indicated in your orderly
configuration and assume that all older migrations have been
applied.  You can specify a lower version here if you want to
force migrations that would otherwise be skipped because they
are assumed to be applied.  Pass <code>"0"</code> (as a string) to match
all previous versions.</p></dd>


<dt id="arg-to">to<a class="anchor" aria-label="anchor" href="#arg-to"></a></dt>
<dd><p>Optional maximum version to migrate to.  If <code>NULL</code> we
apply all possible migrations.  With <code>dry_run = TRUE</code> you may
not want to use this, because we do not write any files,
therefore each migration does not see the results of applying
the previous migration.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Primarily called for side effects, but returns (invisibly)
<code>TRUE</code> if any changes were made (or would be made if <code>dry_run</code>
was <code>TRUE</code>) and <code>FALSE</code> otherwise.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function acts as an interface for rewriting the source code
that will be used to create new packets, it does not migrate any
data from packets that have been run.  The idea here is that if we
make changes to how orderly works that require some repetitive and
relatively simple changes to your code, we can write a script that
will do a reasonable (if not perfect) job of this, and you can run
this over your code, check the results and if you like it commit
the changes to your repository, rather than you having to go
through and change everything by hand.</p>
<p>The version of orderly that you support is indicated by the
version specified in <code>orderly_version.yml</code>; we will change some
warnings to errors once you update this, in order to help you keep
your code up to date.</p>
    </div>
    <div class="section level2">
    <h2 id="migrations">Migrations<a class="anchor" aria-label="anchor" href="#migrations"></a></h2>
    <p>A summary of migrations.  The version number indicates the minimum
version that this would increase your source repository to.</p>
<p>Currently, we do not <em>enforce</em> these changes must be present in a
repository that declares it uses a recent orderly version, but
this may happen at any time, without further warning!</p><div class="section">
<h3 id="-">1.99.82<a class="anchor" aria-label="anchor" href="#-"></a></h3>


<p>Removes references to <code>orderly2</code>, replacing them with <code>orderly</code>.
This affects namespaced calls (e.g.,
<code>orderly2::orderly_parameter()</code>) and calls to <code>library</code> (e.g.,
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(orderly2)</a></code>)</p>
</div>

<div class="section">
<h3 id="--1">1.99.88<a class="anchor" aria-label="anchor" href="#--1"></a></h3>


<p>Renames <code>&lt;name&gt;/orderly.R</code> files to <code>&lt;name&gt;/&lt;name&gt;.R</code>, a change
that we introduced in early 2024 (version 1.99.13).</p>
</div>

<div class="section">
<h3 id="future-migrations">Future migrations<a class="anchor" aria-label="anchor" href="#future-migrations"></a></h3>


<p>We have some old changes to enable here:</p><ul><li><p>enforcing named arguments to <code>orderly_artefact</code></p></li>
</ul><p>We would like to enforce changes to <code>orderly_parameter</code> but have
not worked out a general best practice way of doing this.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="migration-process">Migration process<a class="anchor" aria-label="anchor" href="#migration-process"></a></h2>
    <p>This function requires a clean git status before it is run, and
will typically be best to run against a fresh clone of a
repository (though this is not enforced).  After running, review
changes (if any) with <code>git diff</code> and then commit.  You cannot run
this function against source code that is not version controlled
with git.</p>
<p>We will refuse to migrate sources if we find the directories
<code>archive/</code>, <code>draft/</code> or <code>.outpack/</code> to avoid any chance of
modifying files in packets that have been previously run.  You
should make a fresh clone, migrate that, push back up to GitHub
(or wherever you store your sources) and pull back down into your
working directory.</p>
    </div>
    <div class="section level2">
    <h2 id="migration-of-very-old-sources">Migration of very old sources<a class="anchor" aria-label="anchor" href="#migration-of-very-old-sources"></a></h2>
    <p>If you have old yaml-based orderly sources, you should consult
<code><a href="../articles/migrating.html">vignette("migrating")</a></code> as the migration path is not automatic and
a bit more involved.  You will need to install the helper package
<code>outpack.orderly</code> and migrate your source and your archive
separately.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># If a project already has made the migration from orderly2 to</span></span></span>
<span class="r-in"><span><span class="co"># orderly, then the migration does nothing:</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="orderly_example.html">orderly_example</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created orderly root at '/tmp/RtmpYlhXsR/orderly_ex_1efe4cea1562'</span>
<span class="r-in"><span><span class="fu">orderly_migrate_source</span><span class="op">(</span><span class="va">path</span>, dry_run <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No migrations to apply</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton, Martin Eden, Alex Hill, Wes Hinsley, Mantra Kusumgar, Paul Liétar, James Thompson, Katy Gaythorpe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

